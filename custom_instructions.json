{
  "type": "SupabaseOperations",
  "migrations": {
    "fileNaming": {
      "pattern": "YYYYMMDDHHMMSS_descriptive_name.sql",
      "examples": {
        "correct": "20250211123001_rename_document_types.sql",
        "incorrect": "[timestamp]_rename_document_types.sql"
      },
      "rules": [
        "Always use actual timestamps, never placeholders",
        "Timestamp must be current or future date/time",
        "Must be after latest existing migration timestamp",
        "Each migration needs matching _down.sql file",
        "Timestamps must be unique across all migrations"
      ],
      "sequence": {
        "check": "SELECT version FROM supabase_migrations.schema_migrations ORDER BY version DESC LIMIT 1",
        "newTimestamp": "Must be greater than latest migration version"
      },
      "troubleshooting": {
        "checkOutput": {
          "description": "When db:check shows mismatched LOCAL vs REMOTE:",
          "steps": [
            "Remove duplicate local migrations (same timestamp)",
            "Get missing remote migrations using db:pull",
            "Ensure new migrations use timestamps after latest remote",
            "Never modify migrations that exist in REMOTE"
          ]
        },
        "commonIssues": {
          "duplicateLocal": "Remove duplicate timestamp files",
          "missingRemote": "Use db:pull to get missing migrations",
          "outOfSequence": "Use timestamp after latest remote migration"
        }
      }
    },
    "template": {
      "location": "supabase/templates/migration.sql",
      "usage": [
        "Copy template content, don't use placeholder timestamp",
        "Generate actual timestamp for filename",
        "Create both up and down migration files"
      ]
    },
    "commands": {
      "create": "pnpm supabase migration new migration_name",
      "apply": "pnpm db:migrate",
      "check": "SELECT version, name FROM supabase_migrations.schema_migrations ORDER BY version"
    }
  }
} 